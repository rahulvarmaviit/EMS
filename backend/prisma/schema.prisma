generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  LEAD
  EMPLOYEE
}

enum AttendanceStatus {
  PRESENT
  LATE
  HALF_DAY
  ABSENT
}

model User {
  id            String   @id @default(uuid())
  mobile_number String   @unique
  password_hash String
  full_name     String
  role          Role
  created_at    DateTime @default(now())
  
  // Relationships
  team_id       String?
  team          Team?    @relation("TeamMembers", fields: [team_id], references: [id])
  
  managed_team  Team?    @relation("TeamLead")
  
  attendance    Attendance[]

  @@map("users")
}

model Team {
  id          String   @id @default(uuid())
  name        String   @unique
  created_at  DateTime @default(now())

  // Relationships
  lead_id     String?  @unique
  lead        User?    @relation("TeamLead", fields: [lead_id], references: [id])
  
  members     User[]   @relation("TeamMembers")

  @@map("teams")
}

model Location {
  id            String   @id @default(uuid())
  name          String
  latitude      Decimal
  longitude     Decimal
  radius_meters Int      @default(50)
  is_active     Boolean  @default(true)
  created_at    DateTime @default(now())

  @@map("locations")
}

model Attendance {
  id             String           @id @default(uuid())
  date           DateTime         @db.Date
  check_in_time  DateTime
  check_out_time DateTime?
  check_in_lat   Decimal
  check_in_long  Decimal
  status         AttendanceStatus
  
  // Relationships
  user_id        String
  user           User             @relation(fields: [user_id], references: [id])

  @@index([user_id, date])
  @@map("attendance")
}
